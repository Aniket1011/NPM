{
	"name": "DF_EQY_DLS_RAW_DLS_CLN_COURSE_DTLS_clone_copy1",
	"properties": {
		"folder": {
			"name": "Equalify"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"linkedService": {
						"referenceName": "LS_DLS_dlzfdpsa",
						"type": "LinkedServiceReference"
					},
					"name": "readcourseresultdata"
				},
				{
					"linkedService": {
						"referenceName": "LS_DLS_dlzfdpsa",
						"type": "LinkedServiceReference"
					},
					"name": "courseresultcleansed"
				},
				{
					"linkedService": {
						"referenceName": "LS_DLS_dlzfdpsa",
						"type": "LinkedServiceReference"
					},
					"name": "DRPreport"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "LS_DLS_dlzfdpsa",
						"type": "LinkedServiceReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "trimspace"
				},
				{
					"name": "selectcols"
				},
				{
					"name": "spaceremove"
				},
				{
					"name": "FilterActiveUsers"
				},
				{
					"name": "selectreqcolumns"
				}
			],
			"scriptLines": [
				"source(output(",
				"          {Item ID} as string,",
				"          {Item Title} as string,",
				"          {Item Status} as string,",
				"          {Program ID} as string,",
				"          {Curriculum ID} as string,",
				"          {KBS Classification } as string,",
				"          {Item Type} as string,",
				"          {Assignment Type} as string,",
				"          {Security Domain (Item)} as string,",
				"          {CPD/CPE Hours (Item)} as double,",
				"          {Item Revision Date} as date,",
				"          {Revision Number} as boolean,",
				"          {Class ID} as integer,",
				"          {Scheduled Offering Start Date} as date,",
				"          {SO/Item Start Time} as string,",
				"          {Class End Date} as date,",
				"          {Scheduled Offering End Time} as string,",
				"          {Completion Date} as string,",
				"          {Completion Time} as string,",
				"          Grade as string,",
				"          {Completion Status ID} as string,",
				"          {Completion Status Description} as string,",
				"          {Total Hours} as double,",
				"          {Credit Hours} as double,",
				"          {Contact Hours} as double,",
				"          {CPD/CPE Hours Awarded} as double,",
				"          Tuition as double,",
				"          {Currency Symbol} as string,",
				"          {Currency ID} as string,",
				"          Instructor as string,",
				"          {Primary Instructor Company ID} as string,",
				"          {Last Update User ID} as string,",
				"          {Last Update Timestamp} as date,",
				"          {Last Update Time} as string,",
				"          {E-signature Meaning Code} as string,",
				"          Comments as string,",
				"          {Local HR ID} as string,",
				"          {First Name} as string,",
				"          {Last Name} as string,",
				"          {Middle Name} as string,",
				"          {Email Address (User)} as string,",
				"          {User ID} as string,",
				"          {Account ID} as string,",
				"          {Account Description} as string,",
				"          {User Status} as string,",
				"          {Employee Status ID} as string,",
				"          {Role ID} as string,",
				"          {Role Description} as string,",
				"          {Job Code ID} as short,",
				"          {Job Code Description} as string,",
				"          {Job Title} as string,",
				"          {Region ID} as string,",
				"          {Country/Region ID} as string,",
				"          {Country/Region} as string,",
				"          {Office Location ID} as string,",
				"          Department as string,",
				"          {Global Function ID} as short,",
				"          {Global Function} as string,",
				"          {Organisation Description} as string,",
				"          Subfunction as string,",
				"          {Employee Class ID} as string,",
				"          {Employee Class Description} as string,",
				"          {Local Job Level} as string,",
				"          {Global Service Line} as short,",
				"          {Global Line of Business} as boolean,",
				"          {Global Sector} as boolean,",
				"          {Legal Entity} as short,",
				"          {Business Group} as string,",
				"          {Is Client Facing?} as boolean,",
				"          {Manager Email Address} as string,",
				"          {Manager First Name} as string,",
				"          {Manager Last Name} as string,",
				"          {Manager Middle Initial} as string,",
				"          {Last Hire Date} as date,",
				"          {LMS Custom Field 11 (Obsolete) } as string,",
				"          {LMS Custom Field 12 (Obsolete) } as string,",
				"          {LMS Custom Field 13 (Obsolete) } as string,",
				"          {LMS Custom Field 1 (Obsolete) } as string,",
				"          SO_Description as string",
				"     ),",
				"     useSchema: false,",
				"     allowSchemaDrift: true,",
				"     validateSchema: true,",
				"     ignoreNoFilesFound: true,",
				"     rowUrlColumn: 'file_name',",
				"     format: 'delimited',",
				"     fileSystem: 'adf',",
				"     folderPath: 'Source1',",
				"     fileName: 'test4.csv',",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\"',",
				"     quoteChar: '\\\"',",
				"     columnNamesAsHeader: true,",
				"     multiLineRow: true) ~> readcourseresultdata",
				"source(output(",
				"          sys_id as string,",
				"          item_id as string,",
				"          item_title as string,",
				"          assignment_type as string,",
				"          revision_number as string,",
				"          class_id as string,",
				"          completion_date as string,",
				"          completion_status_id as string,",
				"          total_hours as string,",
				"          local_hr_id as string,",
				"          user_id as string,",
				"          department as string,",
				"          item_revision_date as string,",
				"          {item status} as string,",
				"          cpe as string",
				"     ),",
				"     useSchema: false,",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: true,",
				"     format: 'delimited',",
				"     fileSystem: 'adf',",
				"     folderPath: 'Source2',",
				"     fileName: 'course_result.csv',",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\"',",
				"     quoteChar: '\\\"',",
				"     columnNamesAsHeader: true,",
				"     multiLineRow: true) ~> courseresultcleansed",
				"source(output(",
				"          {Pers.No.} as string,",
				"          Status as string,",
				"          {Full Name} as string,",
				"          {First Name} as string,",
				"          {Last Name} as string,",
				"          Grade as string,",
				"          Step as string,",
				"          {Work Contract} as string,",
				"          {Cost Centre} as string,",
				"          {Cost Center Description} as string,",
				"          Coverage as string,",
				"          {Performance Group} as string,",
				"          Function as string,",
				"          {Service Line Group} as string,",
				"          {Sub Service} as string,",
				"          {Sub Performance Group} as string,",
				"          Office as string,",
				"          {Continuous Service Date} as string,",
				"          {Name of Employee Group} as string,",
				"          {Name of Employee Subgroup} as string,",
				"          {Work Email} as string,",
				"          {Qualification Table_Name} as string,",
				"          Qualification as string,",
				"          {Qualification Start Date} as string,",
				"          {Qualification End Date} as string,",
				"          {Audit Qualification Held?} as boolean,",
				"          {Grade Entry Date} as string,",
				"          GPID as string",
				"     ),",
				"     useSchema: false,",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     rowUrlColumn: 'filename',",
				"     modifiedAfter: (addDays(currentUTC(),-7)),",
				"     format: 'delimited',",
				"     fileSystem: 'adf',",
				"     folderPath: 'Source3',",
				"     fileName: 'DRP 5113_HC_Qualification_08-07-2024.csv',",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\\',",
				"     quoteChar: '\\\"',",
				"     columnNamesAsHeader: true) ~> DRPreport",
				"courseresultcleansed derive(each(match(type=='string'), $$ = trim(regexReplace(trim($$),'\\r\\n*\\n*','\\n')))) ~> trimspace",
				"spaceremove select(mapColumn(",
				"          {Item ID} = item_id,",
				"          {Item Title} = item_title,",
				"          {Assignment Type} = assignment_type,",
				"          {Revision Number} = revision_number,",
				"          {Class ID} = class_id,",
				"          {Completion Date} = completion_date,",
				"          {Completion Status Id} = completion_status_id,",
				"          {Total hours} = total_hours,",
				"          {Local hr id} = local_hr_id,",
				"          {User Id} = user_id,",
				"          Department = department,",
				"          {Item Revision Date} = item_revision_date,",
				"          {item status},",
				"          cpe",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectcols",
				"trimspace derive(each(match(type=='string'), $$ = case(toString($$) == '', 'NULL', trim(toString($$))))) ~> spaceremove",
				"readcourseresultdata filter({User Status} == 'ACTIVE') ~> FilterActiveUsers",
				"DRPreport select(mapColumn(",
				"          {Pers.No.},",
				"          {Performance Group},",
				"          GPID,",
				"          filename",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> selectreqcolumns",
				"FilterActiveUsers sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'delimited',",
				"     fileSystem: 'adf',",
				"     folderPath: 'Sink1',",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\"',",
				"     quoteChar: '\\\"',",
				"     encodingName: 'WINDOWS-1252',",
				"     columnNamesAsHeader: true,",
				"     partitionFileNames:[(concat('course_result_',toString(currentDate(),'dd-MM-yyy'),'.csv'))],",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sink1"
			]
		}
	}
}